<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= page_title %></title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    /* Modern System Font Stack */
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Avenir Next", avenir, "Segoe UI", "Helvetica Neue", helvetica, Ubuntu, roboto, noto, arial, sans-serif;
    }
    
    /* Google SERP Preview Block */
    .serp-preview {
      font-family: arial, sans-serif; /* Google's exact font */
      border: 1px solid #dadce0;
      border-radius: 8px;
      padding: 1.5rem;
      background: #f8f9fa;
    }
    
    .serp-preview .result-title { 
      font-size: 20px; 
      color: #1a0dab; 
      line-height: 1.3;
      text-decoration: none;
      display: block;
      margin-bottom: 3px;
    }
    .serp-preview .result-url { 
      font-size: 14px; 
      color: #006621; 
      line-height: 1.3;
      margin-bottom: 3px;
    }
    .serp-preview .result-description { 
      font-size: 14px; 
      color: #4d5156; 
      line-height: 1.58;
      margin: 0;
    }
    .serp-preview .result-meta { 
      font-size: 12px; 
      color: #70757a; 
      margin-top: 10px;
    }
    .serp-preview .result-site { 
      font-size: 14px; 
      color: #202124; 
    }
  </style>
</head>
<body>
  
  <!-- Bootstrap 5 Navbar (same as search) -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="https://nimbus.ai"><i class="fas fa-bullseye me-1"></i>Nimbus AI</a>
    </div>
  </nav>

  <div class="container">
    
    <!-- Back to Results Link -->
    <div class="my-3">
      <a href="index.html" class="text-decoration-none">
        <i class="fas fa-arrow-left me-2"></i>Back to Results
      </a>
    </div>
    
    <!-- Clean Header Section -->
    <div class="mb-3">
      <h1 class="h2 mb-1"><%= page_display_name %></h1>
      <p class="text-primary mb-3"><%= url_display %></p>
      
      <!-- One Line Stats Bar -->
      <div class="bg-light p-3 rounded d-flex gap-4 flex-wrap align-items-center">
        <div class="d-flex align-items-center gap-2">
          <i class="fas fa-bullseye text-muted"></i>
          <span class="text-muted text-uppercase">OPTIMIZATION</span>
          <strong class="text-dark"><%= optimization_type.toUpperCase() %></strong>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="text-muted text-uppercase">CONFIDENCE</span>
          <strong class="text-dark"><%= confidence %>%</strong>
        </div>
        <div class="d-flex align-items-center gap-2">
          <strong class="text-dark"><%= changes_count %></strong>
          <span class="text-muted text-uppercase">CHANGES</span>
        </div>
        <% if (tone) { %>
        <div class="d-flex align-items-center gap-2">
          <strong class="text-dark text-uppercase"><%= tone %></strong>
          <span class="text-muted text-uppercase">TONE</span>
          <i class="fas fa-microphone text-muted"></i>
        </div>
        <% } %>
      </div>
    </div>

    <!-- Google SERP Preview Block -->
    <div class="serp-preview mb-4 position-relative">
      <div class="position-absolute top-0 start-0 p-2">
        <small class="text-muted">SERP Listing</small>
      </div>
      
      <div class="pt-4">
        <div class="d-flex align-items-center mb-1">
          <img src="<%= favicon_url %>" 
               alt="<%= business_name %> favicon"
               width="16" height="16" 
               class="me-2"
               onerror="this.src='data:image/svg+xml,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 16 16&quot;><circle cx=&quot;8&quot; cy=&quot;8&quot; r=&quot;6&quot; fill=&quot;%231a73e8&quot;/></svg>'">
          <span class="result-site"><%= business_name %></span>
        </div>
        
        <div class="result-url"><%= url_display %></div>
        <div class="result-title"><%= optimized_title %></div>
        <div class="result-description"><%= optimized_description %></div>
        
        <div class="result-meta">
          <%= cache_status %> • <%= confidence %>% confidence • <%= changes_count %> changes
          <% if (tone) { %> • <i class="fas fa-microphone"></i> <%= tone %> tone<% } %>
        </div>
      </div>
    </div>

    <!-- Hero Section Preview (Only for Tier 2+ Above-Fold) -->
    <% if (tier >= 2) { %>
    <div class="bg-gradient-primary text-white rounded-3 p-5 text-center mb-4 position-relative" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <div class="position-absolute top-0 start-0 p-2">
        <small class="text-white">CTA Preview</small>
      </div>
      
      <div class="row align-items-center pt-3">
        <div class="col-md-8">
          <h1 class="display-5 fw-bold mb-3">
            <%= optimized_h1 || optimized_title %>
          </h1>
          <p class="lead mb-4">
            <%= (optimized_body_content || optimized_description).split('\n\n')[0] %>
          </p>
          <div class="d-flex gap-3 justify-content-center">
            <% if (optimized_primary_cta && !optimized_primary_cta.includes('0800') && !optimized_primary_cta.includes('@')) { %>
            <a href="#" class="btn btn-light btn-lg"><%= optimized_primary_cta %></a>
            <% } else if (primary_cta) { %>
            <a href="#" class="btn btn-light btn-lg"><%= primary_cta %></a>
            <% } else { %>
            <a href="#" class="btn btn-light btn-lg">Get Quote Now</a>
            <% } %>
            <% if (optimized_secondary_cta) { %>
            <a href="#" class="btn btn-outline-light btn-lg"><%= optimized_secondary_cta %></a>
            <% } else if (secondary_cta) { %>
            <a href="#" class="btn btn-outline-light btn-lg"><%= secondary_cta %></a>
            <% } else { %>
            <a href="#" class="btn btn-outline-light btn-lg">Learn More</a>
            <% } %>
          </div>
        </div>
        <% if (hero_image) { %>
        <div class="col-md-4">
          <img src="<%= hero_image %>" 
               alt="Hero image" 
               class="img-fluid rounded shadow"
               style="max-height: 200px; object-fit: cover;">
        </div>
        <% } %>
      </div>
    </div>
    <% } %>

    <!-- Before/After Comparison (Progressive Content) -->
    <% if (show_comparison) { %>
      <hr>
    <div class="mb-4">
      <h3 class="h5 mb-4 text-center">
        <i class="fas fa-bullseye me-2"></i>Before vs After Comparison
      </h3>
            
      <!-- Page Title Row -->
      <% if (original_title) { %>
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="small text-muted text-uppercase fw-bold mb-2">Page Title</div>
          <div class="p-2 bg-light rounded border-start border-warning border-3 text-muted">
            <%= original_title %>
            <div class="small text-muted mt-1"><%= original_title_length %>/60 characters</div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="small text-muted text-uppercase fw-bold mb-2">
            <i class="fas fa-bullseye me-1 text-muted"></i>OPTIMIZED WITH AI
          </div>
          <div class="p-2 bg-light rounded border-start border-success border-3">
            <%= optimized_title %>
            <div class="small text-muted mt-1"><%= title_length %>/60 characters</div>
          </div>
        </div>
      </div>
      <% } %>
            
      <!-- Meta Description Row -->
      <% if (original_description) { %>
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="small text-muted text-uppercase fw-bold mb-2">Meta Description</div>
          <div class="p-2 bg-light rounded border-start border-warning border-3 text-muted">
            <%= original_description %>
            <div class="small text-muted mt-1"><%= original_desc_length %>/160 characters</div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="small text-muted text-uppercase fw-bold mb-2">
            <i class="fas fa-bullseye me-1 text-muted"></i>OPTIMIZED WITH AI
          </div>
          <div class="p-2 bg-light rounded border-start border-success border-3">
            <%= optimized_description %>
            <div class="small text-muted mt-1"><%= desc_length %>/160 characters</div>
          </div>
        </div>
      </div>
      <% } %>
            
      <!-- H1 Headline Row (Tier 2+) -->
      <% if (tier >= 2 && original_h1) { %>
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="small text-muted text-uppercase fw-bold mb-2">H1 Headline</div>
          <div class="p-2 bg-light rounded border-start border-warning border-3 text-muted">
            <%= original_h1 %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="small text-muted text-uppercase fw-bold mb-2">
            <i class="fas fa-bullseye me-1 text-muted"></i>OPTIMIZED WITH AI
          </div>
          <div class="p-2 bg-light rounded border-start border-success border-3">
            <%= optimized_h1 || optimized_title %>
          </div>
        </div>
      </div>
      <% } %>
            
             <!-- H2 Subheadline Row (Tier 2+) -->
       <% if (tier >= 2 && original_h2) { %>
       <div class="row mb-3">
         <div class="col-md-6">
           <div class="small text-muted text-uppercase fw-bold mb-2">H2 Subheadline</div>
           <div class="p-2 bg-light rounded border-start border-warning border-3 text-muted">
             <%= original_h2 %>
           </div>
         </div>
         <div class="col-md-6">
           <div class="small text-muted text-uppercase fw-bold mb-2">
             <i class="fas fa-bullseye me-1 text-muted"></i>OPTIMIZED WITH AI
           </div>
           <div class="p-2 bg-light rounded border-start border-success border-3">
             <%= optimized_h2 || optimized_description %>
           </div>
         </div>
       </div>
       <% } %>

       <!-- Individual Content Blocks Comparison (Tier 2+) -->
       <% if (tier >= 2 && content_blocks && content_blocks.length > 0) { %>
         <div class="alert alert-info mb-3">
           <i class="fas fa-info-circle me-2"></i>
           <strong>Note:</strong> The AI enhances existing content blocks while maintaining the same context and meaning. 
           Each block shows the original content (Before) and the AI-enhanced version (After) with the same ID for perfect matching.
         </div>
         
         <% content_blocks.forEach(function(block, index) { %>
         <div class="row mb-3">
           <div class="col-md-6">
             <div class="small text-muted text-uppercase fw-bold mb-2">
               <i class="fas fa-code me-1 text-muted"></i>Block <%= block.id || (index + 1) %>
             </div>
             <div class="p-2 bg-light rounded border-start border-warning border-3 text-muted">
               <%= block.original_text %>
               <div class="small text-muted mt-1">ID: <%= block.id || (index + 1) %></div>
             </div>
           </div>
           <div class="col-md-6">
             <div class="small text-muted text-uppercase fw-bold mb-2">
               <i class="fas fa-bullseye me-1 text-muted"></i>AI ENHANCED CONTENT
             </div>
             <div class="p-2 bg-light rounded border-start border-success border-3">
               <%= block.optimized_text %>
               <div class="small text-muted mt-1">ID: <%= block.id || (index + 1) %></div>
             </div>
           </div>
         </div>
         <% }); %>
       <% } %>

       <!-- Primary CTA Row (Tier 2+) -->
       <% if (tier >= 2 && original_primary_cta && !original_primary_cta.includes('0800') && !original_primary_cta.includes('@')) { %>
       <div class="row mb-3">
         <div class="col-md-6">
           <div class="small text-muted text-uppercase fw-bold mb-2">Primary CTA</div>
           <div class="p-2 bg-light rounded border-start border-warning border-3 text-muted">
             <%= original_primary_cta %>
           </div>
         </div>
         <div class="col-md-6">
           <div class="small text-muted text-uppercase fw-bold mb-2">
             <i class="fas fa-bullseye me-1 text-muted"></i>OPTIMIZED WITH AI
           </div>
           <div class="p-2 bg-light rounded border-start border-success border-3">
             <%= optimized_primary_cta || 'Get Quote Now' %>
           </div>
         </div>
       </div>
       <% } %>

    </div>
    <hr>
    <% } %>

    <!-- AI Notes Section -->
    <% if (ai_notes && ai_notes.length > 0) { %>
    <div class="bg-light p-3 rounded mb-4">
      <h3 class="h6 text-dark mb-3">AI Optimization Notes</h3>
      <ul class="mb-0 text-dark">
        <% ai_notes.forEach(function(note) { %>
        <li><%= note %></li>
        <% }); %>
      </ul>
    </div>
    <% } %>
    
  </div>

  <!-- Bootstrap 5 Footer (same as search) -->
  <footer class="bg-light border-top mt-5 py-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <p class="mb-0 text-muted">
            🎯 <%= optimization_type %> • Generated by 
            <a href="https://nimbus.ai" class="text-decoration-none" target="_blank">Nimbus AI</a>
          </p>
        </div>
        <div class="col-md-6 text-md-end">
          <p class="mb-0 text-muted small">
            Report generated: <%= generated_at %>
          </p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
